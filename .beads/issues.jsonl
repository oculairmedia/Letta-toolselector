{"id":"lettatoolsselector-01y","title":"[Test] Unit test: SDK list_agent_tools handles pagination","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-23T18:41:36.044718513Z","updated_at":"2025-12-27T07:25:33.120630503Z","comments":[{"id":60,"issue_id":"lettatoolsselector-01y","author":"node","text":"## Purpose\n\nGuard against regression where pagination is forgotten and only partial tools returned.\n\n## Test Scenario\n\n1. Mock Letta API to return 10 tools per page (3 pages total = 30 tools)\n2. Call list_agent_tools(agent_id)\n3. Assert: Returns all 30 tools\n4. Assert: Makes correct number of API calls\n\n## Acceptance Criteria\n\n- [ ] Test uses mocked responses (no real API)\n- [ ] Covers edge cases: 0 tools, exactly 1 page, multiple pages\n- [ ] Fails if fewer tools returned than expected\n- [ ] Runs in \u003c 1 second\n\n## Technical Notes\n\n- Use pytest-mock or responses library\n- Part of SDK test suite\n- Tag as \n\n---\nHuly Issue: LTSEL-21","created_at":"2025-12-23T18:41:36Z"}]}
{"id":"lettatoolsselector-06d","title":"[SDK] Migrate webhook-receiver to use shared SDK","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:26.226044359Z","updated_at":"2025-12-23T03:26:57.985147101Z","comments":[{"id":2,"issue_id":"lettatoolsselector-06d","author":"node","text":"## Problem\n\nWebhook receiver has its own tool management code that will drift from the SDK.\n\n## Solution\n\nReplace local implementations with SDK imports.\n\n## Acceptance Criteria\n\n- [ ] Add  to \n- [ ] Replace  functions with SDK imports\n- [ ] Replace  API calls with SDK helpers\n- [ ] All existing tests still pass\n- [ ] No functional changes to webhook behavior\n\n## Technical Notes\n\n- This is a refactor, not a feature change\n- May need to keep some webhook-specific wrappers\n\n---\nHuly Issue: LTSEL-5","created_at":"2025-12-22T23:46:26Z"}]}
{"id":"lettatoolsselector-07p","title":"[Observability] Add health check endpoint with tool state summary","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:09.047844161Z","updated_at":"2025-12-23T03:23:09.420110481Z","closed_at":"2025-12-23T03:23:09.420110481Z","close_reason":"Closed","comments":[{"id":33,"issue_id":"lettatoolsselector-07p","author":"node","text":"## Problem\n\nCurrent health endpoint only returns basic status. No way to quickly check if tool management is working correctly.\n\n## Solution\n\nEnhance health endpoint to include tool state summary.\n\n## Acceptance Criteria\n\n- [ ] Health endpoint returns: status, version, config summary\n- [ ] Include: MAX_TOTAL_TOOLS, PROTECTED_TOOLS list\n- [ ] Include: total_agents_tracked, agents_over_limit count\n- [ ] Include: last_attach_timestamp, last_prune_timestamp\n- [ ] Separate deep health check for dependencies (Letta API, Weaviate)\n\n## Technical Notes\n\n- Keep lightweight for frequent polling\n- Deep health check on separate endpoint (/health/deep)\n\n---\nHuly Issue: LTSEL-14","created_at":"2025-12-23T03:23:09Z"}]}
{"id":"lettatoolsselector-08q","title":"[Observability] Create Grafana dashboard for tool state","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-27T04:21:29.988244491Z","updated_at":"2025-12-27T04:21:29.988244491Z","comments":[{"id":220,"issue_id":"lettatoolsselector-08q","author":"root","text":"Synced from Beads: lettatoolsselector-9fs\n\n---\nHuly Issue: LTSEL-58","created_at":"2025-12-27T04:21:30Z"}]}
{"id":"lettatoolsselector-09g","title":"[SDK] Migrate tool-selector to use shared SDK","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:04.520360479Z","updated_at":"2025-12-23T03:23:04.874634818Z","closed_at":"2025-12-23T03:23:04.874634818Z","close_reason":"Closed","comments":[{"id":27,"issue_id":"lettatoolsselector-09g","author":"node","text":"## Problem\n\nTool selector has its own  and  that duplicate SDK functionality.\n\n## Solution\n\nReplace local implementations with SDK imports.\n\n## Acceptance Criteria\n\n- [ ] Add  to \n- [ ] Replace  helpers with SDK imports\n- [ ] Replace  with SDK imports\n- [ ] All existing tests still pass\n- [ ] No functional changes to tool selection behavior\n\n## Technical Notes\n\n- Worker service models may need adjustment\n- Keep API-specific logic in the repo, move generic logic to SDK\n\n---\nHuly Issue: LTSEL-6","created_at":"2025-12-23T03:23:04Z"}]}
{"id":"lettatoolsselector-0g6","title":"[SDK] Implement attach/detach tool helpers with retry logic","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:27.711027378Z","updated_at":"2025-12-23T03:27:00.609452772Z"}
{"id":"lettatoolsselector-14s","title":"[SDK] Migrate webhook-receiver to use shared SDK","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:03.941511875Z","updated_at":"2025-12-23T03:23:04.323825275Z","closed_at":"2025-12-23T03:23:04.323825275Z","close_reason":"Closed","comments":[{"id":26,"issue_id":"lettatoolsselector-14s","author":"node","text":"## Problem\n\nWebhook receiver has its own tool management code that will drift from the SDK.\n\n## Solution\n\nReplace local implementations with SDK imports.\n\n## Acceptance Criteria\n\n- [ ] Add  to \n- [ ] Replace  functions with SDK imports\n- [ ] Replace  API calls with SDK helpers\n- [ ] All existing tests still pass\n- [ ] No functional changes to webhook behavior\n\n## Technical Notes\n\n- This is a refactor, not a feature change\n- May need to keep some webhook-specific wrappers\n\n---\nHuly Issue: LTSEL-5","created_at":"2025-12-23T03:23:04Z"}]}
{"id":"lettatoolsselector-19c","title":"[Test] Contract test: Tool selector API returns valid response","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:28.355127429Z","updated_at":"2025-12-22T23:46:28.355127429Z","comments":[{"id":15,"issue_id":"lettatoolsselector-19c","author":"node","text":"## Purpose\n\nGuard against tool selector API returning unexpected response format.\n\n## Test Scenario\n\n1. Send valid attach request to tool selector API\n2. Capture response\n3. Assert: Response matches documented contract schema\n4. Assert: All required fields present (success, details.attached, details.detached)\n\n## Acceptance Criteria\n\n- [ ] Test validates response structure\n- [ ] Covers success and error responses\n- [ ] Fails if response doesn't match contract\n- [ ] Runs in tool-selector CI\n\n## Technical Notes\n\n- Can use real API or mocked\n- Reference contract from LTSEL-9\n- Tag as \n\n---\nHuly Issue: LTSEL-24","created_at":"2025-12-22T23:46:28Z"}]}
{"id":"lettatoolsselector-1vb","title":"[Test] Contract test: Webhook receiver sends valid attach payload","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:28.451265395Z","updated_at":"2025-12-22T23:46:28.451265395Z","comments":[{"id":16,"issue_id":"lettatoolsselector-1vb","author":"node","text":"## Purpose\n\nGuard against drift between webhook receiver and tool selector API contract.\n\n## Test Scenario\n\n1. Trigger webhook with known payload\n2. Capture the request sent to tool selector API\n3. Assert: Request matches documented contract schema\n4. Assert: All required fields present (agent_id, query, keep_tools)\n\n## Acceptance Criteria\n\n- [ ] Test validates payload structure, not behavior\n- [ ] Uses recorded/mocked tool selector response\n- [ ] Fails if payload doesn't match contract\n- [ ] Runs in webhook-receiver CI\n\n## Technical Notes\n\n- Use pytest with request capture (responses library)\n- Reference contract from LTSEL-9\n- Tag as \n\n---\nHuly Issue: LTSEL-23","created_at":"2025-12-22T23:46:28Z"}]}
{"id":"lettatoolsselector-24z","title":"[Test] Unit test: ensure_protected_tools attaches missing tools","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:17.158269365Z","updated_at":"2025-12-23T03:23:17.158269365Z","comments":[{"id":41,"issue_id":"lettatoolsselector-24z","author":"node","text":"## Purpose\n\nGuard against regression where protected tools logic fails silently.\n\n## Test Scenarios\n\n1. Agent has all protected tools -\u003e Returns already_present, no attach calls\n2. Agent missing find_agents -\u003e Attaches it, returns in attached list\n3. Tool ID lookup fails -\u003e Returns in failed list with reason\n4. Attach API fails -\u003e Returns in failed list with reason\n\n## Acceptance Criteria\n\n- [ ] All 4 scenarios covered\n- [ ] Uses mocked API responses\n- [ ] Verifies correct API calls made\n- [ ] Runs in \u003c 1 second\n\n## Technical Notes\n\n- Use pytest-mock\n- Part of SDK test suite\n- Tag as \n\n---\nHuly Issue: LTSEL-22","created_at":"2025-12-23T03:23:17Z"}]}
{"id":"lettatoolsselector-2a2","title":"[Test] Unit test: ensure_protected_tools attaches missing tools","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-23T03:27:59.540444503Z","updated_at":"2025-12-23T03:27:59.540444503Z","comments":[{"id":50,"issue_id":"lettatoolsselector-2a2","author":"node","text":"Synced from Beads: lettatoolsselector-e6b\n\n---\nHuly Issue: LTSEL-35","created_at":"2025-12-23T03:27:59Z"}]}
{"id":"lettatoolsselector-35e","title":"[Config] Add config validation to CI pipeline","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:19.20176836Z","updated_at":"2025-12-23T03:23:19.20176836Z","comments":[{"id":45,"issue_id":"lettatoolsselector-35e","author":"node","text":"## Problem\n\nInvalid config values (e.g., MAX_TOTAL_TOOLS \u003e MAX_MCP_TOOLS) can be deployed without warning.\n\n## Solution\n\nAdd CI job that validates configuration constraints.\n\n## Acceptance Criteria\n\n- [ ] CI job runs on every PR\n- [ ] Validates: MAX_TOTAL_TOOLS \u003c= MAX_MCP_TOOLS\n- [ ] Validates: MIN_MCP_TOOLS \u003c= MAX_TOTAL_TOOLS\n- [ ] Validates: PROTECTED_TOOLS contains valid tool names\n- [ ] Fails build with clear error message on invalid config\n\n## Technical Notes\n\n- Can be a simple Python script\n- Read from .env.example for defaults\n- Consider JSON schema for config validation\n\n---\nHuly Issue: LTSEL-16","created_at":"2025-12-23T03:23:19Z"}]}
{"id":"lettatoolsselector-3iy","title":"[Config] Consolidate .env files and compose configurations","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:07.521149427Z","updated_at":"2025-12-23T03:23:07.879876339Z","closed_at":"2025-12-23T03:23:07.879876339Z","close_reason":"Closed","comments":[{"id":31,"issue_id":"lettatoolsselector-3iy","author":"node","text":"## Problem\n\nTool selector has multiple compose files (compose.yaml, docker-compose.yml, compose-with-reranker.yaml) and an .env file. Changes require editing multiple places.\n\n## Solution\n\nConsolidate to single compose.yaml with environment-specific overrides via .env.\n\n## Acceptance Criteria\n\n- [ ] Single compose.yaml as source of truth\n- [ ] .env.example checked into repo with all variables documented\n- [ ] .env (not checked in) for local overrides\n- [ ] Remove deprecated docker-compose.yml\n- [ ] CI validates .env.example has all required vars\n\n## Technical Notes\n\n- Use compose profiles for optional services (reranker, etc.)\n- Document which vars are required vs optional\n- Add validation script to check env completeness\n\n---\nHuly Issue: LTSEL-15","created_at":"2025-12-23T03:23:07Z"}]}
{"id":"lettatoolsselector-418","title":"[Config] Create automated deploy script","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:18.823169301Z","updated_at":"2025-12-23T03:23:18.823169301Z","comments":[{"id":44,"issue_id":"lettatoolsselector-418","author":"node","text":"## Problem\n\nChanging config requires manual: edit .env, restart container, verify health. This is error-prone.\n\n## Solution\n\nCreate a deploy script that handles config updates safely.\n\n## Acceptance Criteria\n\n- [ ] Script:  to update and restart\n- [ ] Validates config before deploying\n- [ ] Backs up current .env before changes\n- [ ] Waits for health check after restart\n- [ ] Rolls back on health check failure\n- [ ] Logs all actions for audit\n\n## Technical Notes\n\n- Use docker compose up -d --force-recreate\n- Add --dry-run flag for testing\n- Consider GitHub Action for remote deploys\n\n---\nHuly Issue: LTSEL-17","created_at":"2025-12-23T03:23:19Z"}]}
{"id":"lettatoolsselector-4tm","title":"[SDK] Create letta-toolkit Python package scaffold","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:12.941728881Z","updated_at":"2025-12-23T03:23:13.332563419Z","closed_at":"2025-12-23T03:23:13.332563419Z","close_reason":"Closed","comments":[{"id":36,"issue_id":"lettatoolsselector-4tm","author":"node","text":"## Problem\n\nTool management logic is duplicated across webhook-receiver and tool-selector repos, causing drift and inconsistent behavior.\n\n## Solution\n\nCreate a shared Python package  that can be installed in both repos.\n\n## Acceptance Criteria\n\n- [ ] Package scaffold with  and proper versioning\n- [ ] Package published to private PyPI or installable via git+https\n- [ ] Basic CI/CD pipeline for testing and publishing\n- [ ] README with installation and usage instructions\n\n## Technical Notes\n\n- Use  layout for clean imports\n- Target Python 3.11+\n- Include type hints throughout\n\n---\nHuly Issue: LTSEL-1","created_at":"2025-12-23T03:23:13Z"}]}
{"id":"lettatoolsselector-5l3","title":"[Test] Contract test: Webhook receiver sends valid attach payload","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:16.775680432Z","updated_at":"2025-12-23T03:23:16.775680432Z","comments":[{"id":40,"issue_id":"lettatoolsselector-5l3","author":"node","text":"## Purpose\n\nGuard against drift between webhook receiver and tool selector API contract.\n\n## Test Scenario\n\n1. Trigger webhook with known payload\n2. Capture the request sent to tool selector API\n3. Assert: Request matches documented contract schema\n4. Assert: All required fields present (agent_id, query, keep_tools)\n\n## Acceptance Criteria\n\n- [ ] Test validates payload structure, not behavior\n- [ ] Uses recorded/mocked tool selector response\n- [ ] Fails if payload doesn't match contract\n- [ ] Runs in webhook-receiver CI\n\n## Technical Notes\n\n- Use pytest with request capture (responses library)\n- Reference contract from LTSEL-9\n- Tag as \n\n---\nHuly Issue: LTSEL-23","created_at":"2025-12-23T03:23:16Z"}]}
{"id":"lettatoolsselector-5vu","title":"[Config] Add config validation to CI pipeline","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-23T03:28:00.54116237Z","updated_at":"2025-12-23T03:28:00.54116237Z","comments":[{"id":53,"issue_id":"lettatoolsselector-5vu","author":"node","text":"Synced from Beads: lettatoolsselector-388\n\n---\nHuly Issue: LTSEL-31","created_at":"2025-12-23T03:28:00Z"}]}
{"id":"lettatoolsselector-5xn","title":"[Test] Integration test: Protected tools never detached","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:05.985338423Z","updated_at":"2025-12-23T03:23:06.372637179Z","closed_at":"2025-12-23T03:23:06.372637179Z","close_reason":"Closed","comments":[{"id":29,"issue_id":"lettatoolsselector-5xn","author":"node","text":"## Purpose\n\nRegression guard to ensure protected tools are never removed during pruning.\n\n## Test Scenario\n\n1. Create test agent with MAX_TOTAL_TOOLS tools including find_agents\n2. Trigger attachment that would require pruning\n3. Assert: find_agents is still attached after operation\n4. Repeat for each protected tool in PROTECTED_TOOLS list\n\n## Acceptance Criteria\n\n- [ ] Test runs in CI on every PR\n- [ ] Covers all configured protected tools\n- [ ] Fails if any protected tool is detached\n- [ ] Logs which tools were pruned vs preserved\n\n## Technical Notes\n\n- Parameterize test over PROTECTED_TOOLS list\n- Use pytest-parametrize for clean test output\n- Tag as \n\n---\nHuly Issue: LTSEL-20","created_at":"2025-12-23T03:23:06Z"}]}
{"id":"lettatoolsselector-626","title":"[Config] Document operational runbooks","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:28.787444478Z","updated_at":"2025-12-22T23:46:28.787444478Z","comments":[{"id":19,"issue_id":"lettatoolsselector-626","author":"node","text":"## Problem\n\nNo documentation for common ops tasks. Each debugging session rediscovers the same steps.\n\n## Solution\n\nCreate runbooks for common operations.\n\n## Acceptance Criteria\n\n- [ ] Runbook: How to change MAX_TOTAL_TOOLS limit\n- [ ] Runbook: How to add/remove protected tools\n- [ ] Runbook: How to manually prune an agent's tools\n- [ ] Runbook: How to debug \"tool not attaching\" issues\n- [ ] Runbook: How to check tool selector health\n- [ ] Store in docs/ directory within repo\n\n## Technical Notes\n\n- Include exact commands with expected outputs\n- Link to relevant compose services and env vars\n- Keep updated as architecture evolves\n\n---\nHuly Issue: LTSEL-18","created_at":"2025-12-22T23:46:28Z"}]}
{"id":"lettatoolsselector-6fh","title":"[Enforcement] Create scheduled agent tool pruning job","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:29.355653376Z","updated_at":"2025-12-22T23:46:29.355653376Z","comments":[{"id":24,"issue_id":"lettatoolsselector-6fh","author":"node","text":"## Problem\n\nIf no webhook runs for an agent, tools accumulate without being pruned. Need a background job to enforce limits.\n\n## Solution\n\nCreate a scheduled job that scans all agents and prunes any that exceed MAX_TOTAL_TOOLS.\n\n## Acceptance Criteria\n\n- [ ] Cron or Celery beat job runs daily\n- [ ] Fetches all agents from Letta API\n- [ ] For each agent exceeding limit, prune to MAX_TOTAL_TOOLS\n- [ ] Respects protected tools list\n- [ ] Logs all pruning actions with agent ID and tool names\n- [ ] Emits metrics for monitoring (agents_pruned, tools_removed)\n\n## Technical Notes\n\n- Run at low-traffic time (e.g., 3 AM)\n- Use batch operations for efficiency\n- Consider rate limiting to avoid overwhelming Letta API\n\n---\nHuly Issue: LTSEL-8","created_at":"2025-12-22T23:46:29Z"}]}
{"id":"lettatoolsselector-6he","title":"[Observability] Add Prometheus metrics to tool selector API","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:19.698941683Z","updated_at":"2025-12-23T03:23:19.698941683Z","comments":[{"id":46,"issue_id":"lettatoolsselector-6he","author":"node","text":"## Problem\n\nNo quantitative metrics for monitoring tool attachment operations.\n\n## Solution\n\nAdd Prometheus metrics endpoint to tool selector API.\n\n## Acceptance Criteria\n\n- [ ]  endpoint exposing Prometheus format\n- [ ] Counters: tools_attached_total, tools_detached_total, tools_pruned_total\n- [ ] Gauges: agent_tool_count (per agent), agents_over_limit\n- [ ] Histograms: attach_request_duration_seconds\n- [ ] Labels: agent_id (for per-agent breakdown)\n\n## Technical Notes\n\n- Use prometheus_client library\n- Expose on separate port or same API\n- Consider cardinality limits on agent_id label\n\n---\nHuly Issue: LTSEL-13","created_at":"2025-12-23T03:23:19Z"}]}
{"id":"lettatoolsselector-6jz","title":"[Observability] Create Grafana dashboard for tool state","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-27T04:21:42.059502963Z","updated_at":"2025-12-27T04:21:42.059502963Z","comments":[{"id":222,"issue_id":"lettatoolsselector-6jz","author":"root","text":"Synced from Beads: lettatoolsselector-7dj\n\n---\nHuly Issue: LTSEL-55","created_at":"2025-12-27T04:21:42Z"}]}
{"id":"lettatoolsselector-6p9","title":"[Observability] Create Grafana dashboard for tool state","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-27T04:21:26.343815909Z","updated_at":"2025-12-27T04:21:26.343815909Z","comments":[{"id":219,"issue_id":"lettatoolsselector-6p9","author":"root","text":"Synced from Beads: lettatoolsselector-57s\n\n---\nHuly Issue: LTSEL-59","created_at":"2025-12-27T04:21:26Z"}]}
{"id":"lettatoolsselector-6sz","title":"[Config] Consolidate .env files and compose configurations","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:26.939734223Z","updated_at":"2025-12-23T03:26:59.127046738Z","comments":[{"id":7,"issue_id":"lettatoolsselector-6sz","author":"node","text":"## Problem\n\nTool selector has multiple compose files (compose.yaml, docker-compose.yml, compose-with-reranker.yaml) and an .env file. Changes require editing multiple places.\n\n## Solution\n\nConsolidate to single compose.yaml with environment-specific overrides via .env.\n\n## Acceptance Criteria\n\n- [ ] Single compose.yaml as source of truth\n- [ ] .env.example checked into repo with all variables documented\n- [ ] .env (not checked in) for local overrides\n- [ ] Remove deprecated docker-compose.yml\n- [ ] CI validates .env.example has all required vars\n\n## Technical Notes\n\n- Use compose profiles for optional services (reranker, etc.)\n- Document which vars are required vs optional\n- Add validation script to check env completeness\n\n---\nHuly Issue: LTSEL-15","created_at":"2025-12-22T23:46:26Z"}]}
{"id":"lettatoolsselector-784","title":"[Enforcement] Create scheduled agent tool pruning job","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:21.106579546Z","updated_at":"2025-12-23T03:23:21.106579546Z","comments":[{"id":48,"issue_id":"lettatoolsselector-784","author":"node","text":"## Problem\n\nIf no webhook runs for an agent, tools accumulate without being pruned. Need a background job to enforce limits.\n\n## Solution\n\nCreate a scheduled job that scans all agents and prunes any that exceed MAX_TOTAL_TOOLS.\n\n## Acceptance Criteria\n\n- [ ] Cron or Celery beat job runs daily\n- [ ] Fetches all agents from Letta API\n- [ ] For each agent exceeding limit, prune to MAX_TOTAL_TOOLS\n- [ ] Respects protected tools list\n- [ ] Logs all pruning actions with agent ID and tool names\n- [ ] Emits metrics for monitoring (agents_pruned, tools_removed)\n\n## Technical Notes\n\n- Run at low-traffic time (e.g., 3 AM)\n- Use batch operations for efficiency\n- Consider rate limiting to avoid overwhelming Letta API\n\n---\nHuly Issue: LTSEL-8","created_at":"2025-12-23T03:23:21Z"}]}
{"id":"lettatoolsselector-7rj","title":"[Config] Create automated deploy script","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-23T03:28:00.227878853Z","updated_at":"2025-12-23T03:28:00.227878853Z","comments":[{"id":52,"issue_id":"lettatoolsselector-7rj","author":"node","text":"Synced from Beads: lettatoolsselector-hmg\n\n---\nHuly Issue: LTSEL-32","created_at":"2025-12-23T03:28:00Z"}]}
{"id":"lettatoolsselector-80x","title":"[Test] E2E test: Full webhook-to-attachment flow","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:14.296026908Z","updated_at":"2025-12-23T03:23:14.296026908Z","comments":[{"id":38,"issue_id":"lettatoolsselector-80x","author":"node","text":"## Purpose\n\nEnd-to-end smoke test that the entire pipeline works.\n\n## Test Scenario\n\n1. Create test agent in Letta\n2. Send message to agent (triggers webhook)\n3. Wait for webhook processing\n4. Assert: Agent has tools attached based on message content\n5. Assert: Agent tool count \u003c= MAX_TOTAL_TOOLS\n6. Assert: Protected tools present\n7. Cleanup test agent\n\n## Acceptance Criteria\n\n- [ ] Test uses real services (Letta, webhook, tool selector)\n- [ ] Runs nightly or on-demand (too slow for every PR)\n- [ ] Reports detailed failure info\n- [ ] Cleans up all test resources\n\n## Technical Notes\n\n- Use pytest with longer timeout\n- May need retry logic for async operations\n- Tag as \n- Run in isolated test environment if possible\n\n---\nHuly Issue: LTSEL-25","created_at":"2025-12-23T03:23:14Z"}]}
{"id":"lettatoolsselector-8m5","title":"[SDK] Implement ensure_protected_tools helper","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:11.704019765Z","updated_at":"2025-12-23T03:23:11.910721455Z","closed_at":"2025-12-23T03:23:11.910721455Z","close_reason":"Closed"}
{"id":"lettatoolsselector-9kv","title":"[Test] Integration test: Tool count never exceeds MAX_TOTAL_TOOLS","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:26.807195814Z","updated_at":"2025-12-23T03:26:58.921635621Z","comments":[{"id":6,"issue_id":"lettatoolsselector-9kv","author":"node","text":"## Purpose\n\nRegression guard to ensure tool limits are enforced end-to-end.\n\n## Test Scenario\n\n1. Create test agent with MAX_TOTAL_TOOLS-1 tools attached\n2. Trigger webhook with query that matches 5 tools\n3. Assert: Agent tool count \u003c= MAX_TOTAL_TOOLS after operation\n4. Assert: Response includes pruned tools if any were removed\n\n## Acceptance Criteria\n\n- [ ] Test runs in CI on every PR\n- [ ] Uses real tool selector API (integration test)\n- [ ] Cleans up test agent after run\n- [ ] Fails if agent exceeds limit\n\n## Technical Notes\n\n- Use pytest with fixtures for agent setup/teardown\n- May need test-specific MAX_TOTAL_TOOLS value (e.g., 5) for fast testing\n- Tag as \n\n---\nHuly Issue: LTSEL-19","created_at":"2025-12-22T23:46:26Z"}]}
{"id":"lettatoolsselector-9ve","title":"[SDK] Implement ensure_protected_tools helper","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:27.837976718Z","updated_at":"2025-12-23T03:27:00.785021609Z"}
{"id":"lettatoolsselector-9x3","title":"[Test] E2E test: Full webhook-to-attachment flow","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-23T03:27:59.187579944Z","updated_at":"2025-12-23T03:27:59.187579944Z","comments":[{"id":49,"issue_id":"lettatoolsselector-9x3","author":"node","text":"Synced from Beads: lettatoolsselector-egf\n\n---\nHuly Issue: LTSEL-38","created_at":"2025-12-23T03:27:59Z"}]}
{"id":"lettatoolsselector-b1t","title":"[Enforcement] Define and document auto-attachment contract","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:08.070788495Z","updated_at":"2025-12-23T03:23:08.431030137Z","closed_at":"2025-12-23T03:23:08.431030137Z","close_reason":"Closed","comments":[{"id":32,"issue_id":"lettatoolsselector-b1t","author":"node","text":"## Problem\n\nWebhook receiver and tool selector have different ideas about what fields are required, what keep_tools means, and how limits work.\n\n## Solution\n\nDefine a formal contract (JSON schema or Pydantic model) that both sides adhere to.\n\n## Acceptance Criteria\n\n- [ ] Document payload schema: query, agent_id, keep_tools, limit, min_score, protected_tools\n- [ ] Document response schema: success, attached, detached, preserved, errors\n- [ ] Document behavior: what happens when limits are exceeded, how protected tools work\n- [ ] Version the contract (v1) to allow future evolution\n- [ ] Both repos reference the same contract documentation\n\n## Technical Notes\n\n- Consider using OpenAPI/Swagger for formal spec\n- Publish contract in shared docs location or SDK repo\n\n---\nHuly Issue: LTSEL-9","created_at":"2025-12-23T03:23:08Z"}]}
{"id":"lettatoolsselector-b8l","title":"[SDK] Implement attach/detach tool helpers with retry logic","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:11.316159731Z","updated_at":"2025-12-23T03:23:11.516214876Z","closed_at":"2025-12-23T03:23:11.516214876Z","close_reason":"Closed"}
{"id":"lettatoolsselector-bhm","title":"[Test] Integration test: Protected tools never detached","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:26.661060325Z","updated_at":"2025-12-23T03:26:58.657641521Z","comments":[{"id":5,"issue_id":"lettatoolsselector-bhm","author":"node","text":"## Purpose\n\nRegression guard to ensure protected tools are never removed during pruning.\n\n## Test Scenario\n\n1. Create test agent with MAX_TOTAL_TOOLS tools including find_agents\n2. Trigger attachment that would require pruning\n3. Assert: find_agents is still attached after operation\n4. Repeat for each protected tool in PROTECTED_TOOLS list\n\n## Acceptance Criteria\n\n- [ ] Test runs in CI on every PR\n- [ ] Covers all configured protected tools\n- [ ] Fails if any protected tool is detached\n- [ ] Logs which tools were pruned vs preserved\n\n## Technical Notes\n\n- Parameterize test over PROTECTED_TOOLS list\n- Use pytest-parametrize for clean test output\n- Tag as \n\n---\nHuly Issue: LTSEL-20","created_at":"2025-12-22T23:46:26Z"}]}
{"id":"lettatoolsselector-cfc","title":"[Observability] Create Grafana dashboard for tool state","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-27T04:23:26.191104731Z","updated_at":"2025-12-27T05:15:40.413727767Z","comments":[{"id":223,"issue_id":"lettatoolsselector-cfc","author":"root","text":"Synced from Beads: lettatoolsselector-yie\n\n---\nHuly Issue: LTSEL-29","created_at":"2025-12-27T04:23:26Z"}]}
{"id":"lettatoolsselector-cvy","title":"[Observability] Emit structured events for tool attach/detach","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:05.071719446Z","updated_at":"2025-12-23T03:23:05.419749054Z","closed_at":"2025-12-23T03:23:05.419749054Z","close_reason":"Closed","comments":[{"id":28,"issue_id":"lettatoolsselector-cvy","author":"node","text":"## Problem\n\nNo audit trail for tool changes. Debugging requires scraping logs from multiple containers.\n\n## Solution\n\nEmit structured events to a queue/stream whenever tools are attached or detached.\n\n## Acceptance Criteria\n\n- [ ] Event schema: {timestamp, agent_id, tool_id, tool_name, action, reason, source}\n- [ ] Events emitted from tool selector API on every attach/detach\n- [ ] Events written to Redis Stream or similar (low overhead)\n- [ ] Events include correlation ID for tracing webhook -\u003e attach flow\n\n## Technical Notes\n\n- Use Redis Streams for simplicity (XADD)\n- Keep 7 days of events by default\n- Consider also writing to structured log for Loki ingestion\n\n---\nHuly Issue: LTSEL-11","created_at":"2025-12-23T03:23:05Z"}]}
{"id":"lettatoolsselector-d0t","title":"[SDK] Implement list_agent_tools with full pagination","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:12.533425716Z","updated_at":"2025-12-23T03:23:12.739214321Z","closed_at":"2025-12-23T03:23:12.739214321Z","close_reason":"Closed"}
{"id":"lettatoolsselector-hhl","title":"[SDK] Create letta-toolkit Python package scaffold","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:28.031316453Z","updated_at":"2025-12-23T03:27:01.2274054Z","comments":[{"id":12,"issue_id":"lettatoolsselector-hhl","author":"node","text":"## Problem\n\nTool management logic is duplicated across webhook-receiver and tool-selector repos, causing drift and inconsistent behavior.\n\n## Solution\n\nCreate a shared Python package  that can be installed in both repos.\n\n## Acceptance Criteria\n\n- [ ] Package scaffold with  and proper versioning\n- [ ] Package published to private PyPI or installable via git+https\n- [ ] Basic CI/CD pipeline for testing and publishing\n- [ ] README with installation and usage instructions\n\n## Technical Notes\n\n- Use  layout for clean imports\n- Target Python 3.11+\n- Include type hints throughout\n\n---\nHuly Issue: LTSEL-1","created_at":"2025-12-22T23:46:28Z"}]}
{"id":"lettatoolsselector-jql","title":"[Test] Performance test: Tool attachment under load","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:28.165403794Z","updated_at":"2025-12-22T23:46:28.165403794Z","comments":[{"id":13,"issue_id":"lettatoolsselector-jql","author":"node","text":"## Purpose\n\nEnsure tool attachment scales and doesn't degrade under concurrent webhooks.\n\n## Test Scenario\n\n1. Simulate 10 concurrent webhook requests for different agents\n2. Measure: Response time for each request\n3. Measure: Total time to process all requests\n4. Assert: P95 response time \u003c 5 seconds\n5. Assert: No errors or timeouts\n\n## Acceptance Criteria\n\n- [ ] Test uses locust or similar load testing tool\n- [ ] Runs on-demand (not in regular CI)\n- [ ] Reports latency percentiles\n- [ ] Identifies bottlenecks if any\n\n## Technical Notes\n\n- Start with 10 concurrent, scale to 50\n- Monitor Letta API rate limits\n- Tag as \n\n---\nHuly Issue: LTSEL-26","created_at":"2025-12-22T23:46:28Z"}]}
{"id":"lettatoolsselector-kf7","title":"[Enforcement] Add pre-attach pruning to tool selector API","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:26.088411302Z","updated_at":"2025-12-23T03:26:57.73637653Z","comments":[{"id":1,"issue_id":"lettatoolsselector-kf7","author":"node","text":"## Problem\n\nTool selector API has MAX_TOTAL_TOOLS=20 but only enforces it loosely. Agents like Meridian accumulated 44 tools because pruning doesn't run proactively.\n\n## Solution\n\nBefore attaching new tools, prune existing tools to make room within the limit.\n\n## Acceptance Criteria\n\n- [ ] Before any attach operation, fetch current tool count\n- [ ] If current + new \u003e MAX_TOTAL_TOOLS, detach lowest-scored tools first\n- [ ] Protected tools are never detached (use PROTECTED_TOOLS env var)\n- [ ] Return detailed response showing what was pruned and why\n- [ ] Log pruning decisions for debugging\n\n## Technical Notes\n\n- Pruning order: oldest first, then lowest relevance score\n- Consider keeping tools attached in last 24h as \"recent\" protection\n- MAX_TOTAL_TOOLS is now 20\n\n---\nHuly Issue: LTSEL-7","created_at":"2025-12-22T23:46:26Z"}]}
{"id":"lettatoolsselector-mna","title":"[Observability] Add Prometheus metrics to tool selector API","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-23T03:28:00.852182385Z","updated_at":"2025-12-23T03:28:00.852182385Z","comments":[{"id":54,"issue_id":"lettatoolsselector-mna","author":"node","text":"Synced from Beads: lettatoolsselector-sxk\n\n---\nHuly Issue: LTSEL-30","created_at":"2025-12-23T03:28:01Z"}]}
{"id":"lettatoolsselector-mu4","title":"[Observability] Emit structured events for tool attach/detach","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:26.527463806Z","updated_at":"2025-12-23T03:26:58.396924941Z","comments":[{"id":4,"issue_id":"lettatoolsselector-mu4","author":"node","text":"## Problem\n\nNo audit trail for tool changes. Debugging requires scraping logs from multiple containers.\n\n## Solution\n\nEmit structured events to a queue/stream whenever tools are attached or detached.\n\n## Acceptance Criteria\n\n- [ ] Event schema: {timestamp, agent_id, tool_id, tool_name, action, reason, source}\n- [ ] Events emitted from tool selector API on every attach/detach\n- [ ] Events written to Redis Stream or similar (low overhead)\n- [ ] Events include correlation ID for tracing webhook -\u003e attach flow\n\n## Technical Notes\n\n- Use Redis Streams for simplicity (XADD)\n- Keep 7 days of events by default\n- Consider also writing to structured log for Loki ingestion\n\n---\nHuly Issue: LTSEL-11","created_at":"2025-12-22T23:46:26Z"}]}
{"id":"lettatoolsselector-ppg","title":"[SDK] Implement list_agent_tools with full pagination","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:27.934324694Z","updated_at":"2025-12-23T03:27:01.050807446Z"}
{"id":"lettatoolsselector-t4d","title":"[Observability] Create Grafana dashboard for tool state","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-27T04:21:37.225895409Z","updated_at":"2025-12-27T04:21:37.225895409Z","comments":[{"id":221,"issue_id":"lettatoolsselector-t4d","author":"root","text":"Synced from Beads: lettatoolsselector-9fs\n\n---\nHuly Issue: LTSEL-56","created_at":"2025-12-27T04:21:37Z"}]}
{"id":"lettatoolsselector-trs","title":"[Enforcement] Add pre-attach pruning to tool selector API","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:03.021140072Z","updated_at":"2025-12-23T03:23:03.364825813Z","closed_at":"2025-12-23T03:23:03.364825813Z","close_reason":"Closed","comments":[{"id":25,"issue_id":"lettatoolsselector-trs","author":"node","text":"## Problem\n\nTool selector API has MAX_TOTAL_TOOLS=20 but only enforces it loosely. Agents like Meridian accumulated 44 tools because pruning doesn't run proactively.\n\n## Solution\n\nBefore attaching new tools, prune existing tools to make room within the limit.\n\n## Acceptance Criteria\n\n- [ ] Before any attach operation, fetch current tool count\n- [ ] If current + new \u003e MAX_TOTAL_TOOLS, detach lowest-scored tools first\n- [ ] Protected tools are never detached (use PROTECTED_TOOLS env var)\n- [ ] Return detailed response showing what was pruned and why\n- [ ] Log pruning decisions for debugging\n\n## Technical Notes\n\n- Pruning order: oldest first, then lowest relevance score\n- Consider keeping tools attached in last 24h as \"recent\" protection\n- MAX_TOTAL_TOOLS is now 20\n\n---\nHuly Issue: LTSEL-7","created_at":"2025-12-23T03:23:03Z"}]}
{"id":"lettatoolsselector-tzr","title":"[Enforcement] Define and document auto-attachment contract","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:27.069185687Z","updated_at":"2025-12-23T03:26:59.50752046Z","comments":[{"id":8,"issue_id":"lettatoolsselector-tzr","author":"node","text":"## Problem\n\nWebhook receiver and tool selector have different ideas about what fields are required, what keep_tools means, and how limits work.\n\n## Solution\n\nDefine a formal contract (JSON schema or Pydantic model) that both sides adhere to.\n\n## Acceptance Criteria\n\n- [ ] Document payload schema: query, agent_id, keep_tools, limit, min_score, protected_tools\n- [ ] Document response schema: success, attached, detached, preserved, errors\n- [ ] Document behavior: what happens when limits are exceeded, how protected tools work\n- [ ] Version the contract (v1) to allow future evolution\n- [ ] Both repos reference the same contract documentation\n\n## Technical Notes\n\n- Consider using OpenAPI/Swagger for formal spec\n- Publish contract in shared docs location or SDK repo\n\n---\nHuly Issue: LTSEL-9","created_at":"2025-12-22T23:46:27Z"}]}
{"id":"lettatoolsselector-ubk","title":"[Bugfix] Fix set iteration order mismatch in tool pruning result mapping","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:27.486559568Z","updated_at":"2025-12-23T03:27:00.257409133Z","comments":[{"id":11,"issue_id":"lettatoolsselector-ubk","author":"node","text":"## Problem\n\nIn  function (), there was a bug where detachment results could be incorrectly mapped to tool IDs due to set-to-list conversion happening twice.\n\n### Root Cause\n\n\n\nWhile Python 3.7+ maintains insertion order for sets in practice, converting a set to a list twice creates potential for mismatched mappings between async task results and tool IDs.\n\n## Impact\n\n- **Actual detachment operations worked correctly** - tools were being detached properly\n- **Logging/reporting was potentially incorrect** - wrong tool IDs could be logged as success/failure\n- **Debugging confusion** - audit logs may have shown incorrect tool names for detach operations\n\n## Solution\n\nConvert the set to a list **once** and reuse it:\n\n\n\n## Status\n\n**Fixed** - Applied to  lines 1208-1217. Container restarted to apply changes.\n\n## Related\n\n- Similar pattern in  function was already correct (iterates over list directly)\n- Relates to LTSEL-6 (SDK migration) and LTSEL-11 (structured events for attach/detach)\n\n---\nHuly Issue: LTSEL-27","created_at":"2025-12-22T23:46:27Z"}]}
{"id":"lettatoolsselector-ubl","title":"[Bugfix] Fix set iteration order mismatch in tool pruning result mapping","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:10.726358617Z","updated_at":"2025-12-23T03:23:11.118829205Z","closed_at":"2025-12-23T03:23:11.118829205Z","close_reason":"Closed","comments":[{"id":35,"issue_id":"lettatoolsselector-ubl","author":"node","text":"## Problem\n\nIn  function (), there was a bug where detachment results could be incorrectly mapped to tool IDs due to set-to-list conversion happening twice.\n\n### Root Cause\n\n\n\nWhile Python 3.7+ maintains insertion order for sets in practice, converting a set to a list twice creates potential for mismatched mappings between async task results and tool IDs.\n\n## Impact\n\n- **Actual detachment operations worked correctly** - tools were being detached properly\n- **Logging/reporting was potentially incorrect** - wrong tool IDs could be logged as success/failure\n- **Debugging confusion** - audit logs may have shown incorrect tool names for detach operations\n\n## Solution\n\nConvert the set to a list **once** and reuse it:\n\n\n\n## Status\n\n**Fixed** - Applied to  lines 1208-1217. Container restarted to apply changes.\n\n## Related\n\n- Similar pattern in  function was already correct (iterates over list directly)\n- Relates to LTSEL-6 (SDK migration) and LTSEL-11 (structured events for attach/detach)\n\n---\nHuly Issue: LTSEL-27","created_at":"2025-12-23T03:23:10Z"}]}
{"id":"lettatoolsselector-v66","title":"[Test] Integration test: Tool count never exceeds MAX_TOTAL_TOOLS","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:06.562903106Z","updated_at":"2025-12-23T03:23:06.933264976Z","closed_at":"2025-12-23T03:23:06.933264976Z","close_reason":"Closed","comments":[{"id":30,"issue_id":"lettatoolsselector-v66","author":"node","text":"## Purpose\n\nRegression guard to ensure tool limits are enforced end-to-end.\n\n## Test Scenario\n\n1. Create test agent with MAX_TOTAL_TOOLS-1 tools attached\n2. Trigger webhook with query that matches 5 tools\n3. Assert: Agent tool count \u003c= MAX_TOTAL_TOOLS after operation\n4. Assert: Response includes pruned tools if any were removed\n\n## Acceptance Criteria\n\n- [ ] Test runs in CI on every PR\n- [ ] Uses real tool selector API (integration test)\n- [ ] Cleans up test agent after run\n- [ ] Fails if agent exceeds limit\n\n## Technical Notes\n\n- Use pytest with fixtures for agent setup/teardown\n- May need test-specific MAX_TOTAL_TOOLS value (e.g., 5) for fast testing\n- Tag as \n\n---\nHuly Issue: LTSEL-19","created_at":"2025-12-23T03:23:06Z"}]}
{"id":"lettatoolsselector-vc5","title":"[Test] Contract test: Tool selector API returns valid response","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:15.201745315Z","updated_at":"2025-12-23T03:23:15.201745315Z","comments":[{"id":39,"issue_id":"lettatoolsselector-vc5","author":"node","text":"## Purpose\n\nGuard against tool selector API returning unexpected response format.\n\n## Test Scenario\n\n1. Send valid attach request to tool selector API\n2. Capture response\n3. Assert: Response matches documented contract schema\n4. Assert: All required fields present (success, details.attached, details.detached)\n\n## Acceptance Criteria\n\n- [ ] Test validates response structure\n- [ ] Covers success and error responses\n- [ ] Fails if response doesn't match contract\n- [ ] Runs in tool-selector CI\n\n## Technical Notes\n\n- Can use real API or mocked\n- Reference contract from LTSEL-9\n- Tag as \n\n---\nHuly Issue: LTSEL-24","created_at":"2025-12-23T03:23:15Z"}]}
{"id":"lettatoolsselector-vly","title":"[Test] Performance test: Tool attachment under load","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:13.917942507Z","updated_at":"2025-12-23T03:23:13.917942507Z","comments":[{"id":37,"issue_id":"lettatoolsselector-vly","author":"node","text":"## Purpose\n\nEnsure tool attachment scales and doesn't degrade under concurrent webhooks.\n\n## Test Scenario\n\n1. Simulate 10 concurrent webhook requests for different agents\n2. Measure: Response time for each request\n3. Measure: Total time to process all requests\n4. Assert: P95 response time \u003c 5 seconds\n5. Assert: No errors or timeouts\n\n## Acceptance Criteria\n\n- [ ] Test uses locust or similar load testing tool\n- [ ] Runs on-demand (not in regular CI)\n- [ ] Reports latency percentiles\n- [ ] Identifies bottlenecks if any\n\n## Technical Notes\n\n- Start with 10 concurrent, scale to 50\n- Monitor Letta API rate limits\n- Tag as \n\n---\nHuly Issue: LTSEL-26","created_at":"2025-12-23T03:23:14Z"}]}
{"id":"lettatoolsselector-vu4","title":"[SDK] Migrate tool-selector to use shared SDK","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:26.3962366Z","updated_at":"2025-12-23T03:26:58.229633047Z","comments":[{"id":3,"issue_id":"lettatoolsselector-vu4","author":"node","text":"## Problem\n\nTool selector has its own  and  that duplicate SDK functionality.\n\n## Solution\n\nReplace local implementations with SDK imports.\n\n## Acceptance Criteria\n\n- [ ] Add  to \n- [ ] Replace  helpers with SDK imports\n- [ ] Replace  with SDK imports\n- [ ] All existing tests still pass\n- [ ] No functional changes to tool selection behavior\n\n## Technical Notes\n\n- Worker service models may need adjustment\n- Keep API-specific logic in the repo, move generic logic to SDK\n\n---\nHuly Issue: LTSEL-6","created_at":"2025-12-22T23:46:26Z"}]}
{"id":"lettatoolsselector-x0j","title":"[Enforcement] Add PROTECTED_TOOLS support to tool selector API","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:09.617990903Z","updated_at":"2025-12-23T03:23:09.966249296Z","closed_at":"2025-12-23T03:23:09.966249296Z","close_reason":"Closed","comments":[{"id":34,"issue_id":"lettatoolsselector-x0j","author":"node","text":"## Problem\n\nProtected tools (find_agents, find_tools) logic only exists in webhook receiver. Tool selector API should also respect protected tools during pruning.\n\n## Solution\n\nAdd PROTECTED_TOOLS env var to tool selector API and respect it during all detach operations.\n\n## Acceptance Criteria\n\n- [ ] PROTECTED_TOOLS env var (comma-separated tool names)\n- [ ] Before any detach, check if tool is protected\n- [ ] Never detach protected tools even if over limit\n- [ ] Warn if agent is over limit but can't prune due to protected tools\n- [ ] Document protected tools in compose.yaml\n\n## Technical Notes\n\n- Default protected tools: find_agents, find_tools, send_message\n- Allow override via env var\n- Lookup by name, not ID (IDs can change)\n\n---\nHuly Issue: LTSEL-10","created_at":"2025-12-23T03:23:09Z"}]}
{"id":"lettatoolsselector-xde","title":"[Observability] Add health check endpoint with tool state summary","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:27.198050175Z","updated_at":"2025-12-23T03:26:59.808622912Z","comments":[{"id":9,"issue_id":"lettatoolsselector-xde","author":"node","text":"## Problem\n\nCurrent health endpoint only returns basic status. No way to quickly check if tool management is working correctly.\n\n## Solution\n\nEnhance health endpoint to include tool state summary.\n\n## Acceptance Criteria\n\n- [ ] Health endpoint returns: status, version, config summary\n- [ ] Include: MAX_TOTAL_TOOLS, PROTECTED_TOOLS list\n- [ ] Include: total_agents_tracked, agents_over_limit count\n- [ ] Include: last_attach_timestamp, last_prune_timestamp\n- [ ] Separate deep health check for dependencies (Letta API, Weaviate)\n\n## Technical Notes\n\n- Keep lightweight for frequent polling\n- Deep health check on separate endpoint (/health/deep)\n\n---\nHuly Issue: LTSEL-14","created_at":"2025-12-22T23:46:27Z"}]}
{"id":"lettatoolsselector-xoz","title":"[Config] Document operational runbooks","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-23T03:23:18.051512948Z","updated_at":"2025-12-23T03:23:18.051512948Z","comments":[{"id":43,"issue_id":"lettatoolsselector-xoz","author":"node","text":"## Problem\n\nNo documentation for common ops tasks. Each debugging session rediscovers the same steps.\n\n## Solution\n\nCreate runbooks for common operations.\n\n## Acceptance Criteria\n\n- [ ] Runbook: How to change MAX_TOTAL_TOOLS limit\n- [ ] Runbook: How to add/remove protected tools\n- [ ] Runbook: How to manually prune an agent's tools\n- [ ] Runbook: How to debug \"tool not attaching\" issues\n- [ ] Runbook: How to check tool selector health\n- [ ] Store in docs/ directory within repo\n\n## Technical Notes\n\n- Include exact commands with expected outputs\n- Link to relevant compose services and env vars\n- Keep updated as architecture evolves\n\n---\nHuly Issue: LTSEL-18","created_at":"2025-12-23T03:23:18Z"}]}
{"id":"lettatoolsselector-xxx","title":"[Enforcement] Add PROTECTED_TOOLS support to tool selector API","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-22T23:46:27.358861104Z","updated_at":"2025-12-23T03:26:59.997463048Z","comments":[{"id":10,"issue_id":"lettatoolsselector-xxx","author":"node","text":"## Problem\n\nProtected tools (find_agents, find_tools) logic only exists in webhook receiver. Tool selector API should also respect protected tools during pruning.\n\n## Solution\n\nAdd PROTECTED_TOOLS env var to tool selector API and respect it during all detach operations.\n\n## Acceptance Criteria\n\n- [ ] PROTECTED_TOOLS env var (comma-separated tool names)\n- [ ] Before any detach, check if tool is protected\n- [ ] Never detach protected tools even if over limit\n- [ ] Warn if agent is over limit but can't prune due to protected tools\n- [ ] Document protected tools in compose.yaml\n\n## Technical Notes\n\n- Default protected tools: find_agents, find_tools, send_message\n- Allow override via env var\n- Lookup by name, not ID (IDs can change)\n\n---\nHuly Issue: LTSEL-10","created_at":"2025-12-22T23:46:27Z"}]}
